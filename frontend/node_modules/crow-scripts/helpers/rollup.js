const { rollup } = require('rollup')
const rollupConfig = require('../configs/rollup')
const chalk = require('chalk')
const path = require('path')

module.exports = ({
  entryFile = 'src/index.js',
  targets,
  bundleName = 'bundle.js',
  useBuiltIns,
  loose,
  spec,
  debug,
  bundleFormat = 'cjs',
}) =>
  rollup(
    rollupConfig({
      entry: entryFile,
      useBuiltIns,
      loose,
      spec,
      debug,
      targets,
    })
  ).then(bundle =>
    bundle.write({
      format: bundleFormat,
      dest: path.join(path.dirname(entryFile), bundleName)
    })
  ).catch(err => {
    console.error(chalk.red.bold('❯ 💣 Error: '), err)
    throw err
  })
