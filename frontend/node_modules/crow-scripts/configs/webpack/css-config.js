const ExtractTextPlugin = require('extract-text-webpack-plugin')
const cssRule = require('./css-rule')
const sassRule = require('./sass-rule')

module.exports = ({
  cssBundleFile = 'assets/styles.[chunkhash:8].css',
  disableCSS = false,
  browserslist = [],
}) => (config) => {
  if (!disableCSS) {
    config.module.rules[0].oneOf = config.module.rules[0].oneOf.concat([
      cssRule({ targets: { browsers: browserslist } }),
      sassRule({ targets: { browsers: browserslist } })
    ])

    config.plugins = config.plugins.concat([
      new ExtractTextPlugin({
        filename: cssBundleFile,
        allChunks: true
      }),
    ])
  }

  return(config)
}
