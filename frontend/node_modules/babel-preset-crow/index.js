module.exports = ({
  targets = { node: 'current' },
  loose = false,
  spec = false,
  modules = 'commonjs',
  debug = false,
  useBuiltIns = false,
  extendPlugins = [],
  extendPresets = [],
  ignoreRequireExtensions = [],
} = {}) => {
  const basePreset = ({
    presets: [
      [
        require('babel-preset-env'),
        {
          targets,
          loose,
          spec,
          modules,
          debug,
          useBuiltIns,
        },
      ],
      require('babel-preset-flow')
    ],
    plugins: [
      [
        require('babel-plugin-transform-react-jsx'),
        {
          useBuiltIns
        }
      ],
      require('babel-plugin-syntax-jsx'),
      require('babel-plugin-transform-react-display-name'),
      [
        require('babel-plugin-transform-class-properties'),
        {
          spec
        }
      ],
      [
        require('babel-plugin-transform-object-rest-spread'),
        {
          useBuiltIns
        }
      ]
    ]
  })

  if (ignoreRequireExtensions.length !== 0) {
    basePreset.plugins = basePreset.plugins.concat([
      [
        require('babel-plugin-transform-require-ignore').default,
        {
          extensions: ignoreRequireExtensions
        }
      ]
    ])
  }

  return {
    presets: basePreset.presets.concat(extendPresets),
    plugins: basePreset.plugins.concat(extendPlugins)
  }
}
